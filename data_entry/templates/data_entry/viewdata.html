<!DOCTYPE html>
{% load static %}
<html>
<head>
    <meta charset='utf-8'>
    <title>Trackside Ops- View Data</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" href="{% static '/css/main.css' %}">
	<!-- Font awesome CDN -->
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
	<!-- Bootstrap CDN -->
	<!-- BS icons CDN -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
	<!-- BS 5 -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
	<!-- end Bootstrap CDN -->
    <!-- <script src='main.js'></script> -->
</head>
<body>
    <div class="header">
		<div class="row">
			<div class="col-md-4" align="left">
				<!-- <a href="{% url 'view_team' %}" class="logo"><i class="bi bi-people"></i></a> -->
				<a href="{% url 'view_data' %}" class="logo"><i class="bi bi-book"></i></a>
				<a href="{% url 'collectdata' %}" class="logo"><i class="bi bi-plus-lg"></i></a>
			</div>
			<div class="col-md-4" align="left">
				<h2 align="center" class="display-6">Trackside Ops</h2>
			</div>
		</div>
    </div>
	<!-- The div below contains whole body of website -->
	<br>
    <div class="container" align="center">
		<!-- Row that contains dropdown and text box -->
		<div class="row">
			<div class="col-md-4"></div>
			<div class="col-md-2">
				<!-- "Select Field" Dropdown -->
				<select class="form-select" name="cars" id="searchselect">
					<option value="-1">Select a Field</option>
					<option value="0">Date</option>
					<option value="1">Driver</option>
					<option value="2">Drive Day Lead</option>
					<option value="3">Car Type</option>
					<option value="4">Track</option>
					<option value="5">Engine</option>
				</select>
			</div>
			<div class="col-md-4" >
				<!-- Text box to filter -->
				<input class="form-control" onkeyup="filter()" type ="text" id="filter_box" name="param" placeholder ="Search">
			</div>
			<div class=col-md-2 ></div>
		<!-- End row that contains dropdown and text box -->
		</div>
		<br>
		<div class="row">
			<div class="col-md-11">
				<!-- <table class="table table-bordered table-hover table-striped" id="dataTable"> -->
				<table class="table table-striped  table-hover" id="dataTable">
					<tr>
						<th onclick="sortTable(0)">Date</th>
						<th onclick="sortTable(1)">Driver</th>
						<th onclick="sortTable(2)">Drive Day Lead</th>
						<th onclick="sortTable(3)">Car Type</th>
						<th onclick="sortTable(4)">Track</th>
						<th onclick="sortTable(5)">Engine</th>
						<th></th>
					</tr>
					{% for entry in entries %}
						<tr>
							<td align="left" >{{entry.date}}</td>
							<td align="left" >{{entry.driver}}</td>
							<td align="left" >{{entry.drive_day_lead}}</td>
							<td align="left" >{{entry.car_type}}</td>
							<td align="left" >{{entry.track}}</td>
							<td align="left" >{{entry.engine}}</td>
							<td>
								<table>
									<div class='btns'>
										<tr>
											<td>
												<form action="{%url 'collectdata' %}" method="post">
													{% csrf_token %}
													<input type ="text" name="entry_id" style="display: none;" value={{entry.id}}>
													<input type ="text" name="method" style="display: none;" value="load">
													<button class="btn bi-pencil-square"></button>
												</form>
											</td>
											<td>
												<button type="button" class="btn bi-info-circle" data-bs-toggle="modal" data-bs-target="#modal_{{entry.id}}"></button>
												<!-- Modal -->
												<div class="modal fade" id="modal_{{entry.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
													<div class="modal-dialog" role="document">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="modal-title" id="exampleModalLongTitle">View Details </h5>
															<button type="button" class="btn bi-x-lg" data-bs-dismiss="modal" aria-label="Close"></button>
														</div>
														<div class="modal-body">
															<b>Date:</b> {{entry.date}}<br>
															<b>Car Type:</b> {{entry.car_type}}<br>	
															<b>Driver:</b> {{entry.driver}}<br>
															<b>Drive Day Lead:</b> {{entry.drive_day_lead}}<br>
															<b>Dyno:</b> {{entry.is_dyno}}<br>
															<b>RaceSpec:</b> {{entry.is_racespec}}<br>
															<b>Location:</b> {{entry.location}}<br>
															<b>Track:</b> {{entry.track}}<br>
															<b>Weather:</b> {{entry.weather}}<br>
															<b>Air Temperature:</b> {{entry.air_temp}}<br>
															<b>Track Temperature:</b> {{entry.track_temp}}<br>
															<b>Tires:</b> {{entry.tires}}<br>
															<b>Tire Serial Number:</b> {{entry.tire_serial_number}}<br>
															<b>Engine:</b> {{entry.engine}}<br>
															<b>Motor Number:</b> {{entry.motor_num}}<br>
															<b>Comments:</b> {{entry.comments}}<br>
															<b>Created At:</b> {{entry.created_at}}<br>
														</div>
														<div class="modal-footer">
															<form action="{%url 'collectdata' %}" method="post">
																{% csrf_token %}
																<input type ="text" name="entry_id" style="display: none;" value={{entry.id}}>
																<input type ="text" name="method" style="display: none;" value="load">
																<button id="edit-modal" class="btn bi-pencil-square"></button>
															</form>
															<form action="{%url 'view_data' %}" method="post">
																{% csrf_token %}
																<input type ="text" name="entry_id" style="display: none;" value={{entry.id}}>
																<input type ="text" name="method" style="display: none;" value="delete">
																<button class="btn bi-trash"></button>
															</form>
														</div>
													</div>
													</div>
												</div>
											</td>
											<td>
												<form action="{%url 'view_data' %}" method="post">
													{% csrf_token %}
													<input type ="text" name="entry_id" style="display: none;" value={{entry.id}}>
													<input type ="text" name="method" style="display: none;" value="delete">
													<button class="btn bi-trash" data-bs-toggle="modal" data-bs-target="#confirm_delete"></button>
												</form>
											</td>
										</tr>
									</div>                  
								</table>
							</td>
						</tr>
					{% endfor %}
				</table>
			</div>
		</div>
    </div>
	<script>
	function filter() {
		var input, filter, table, tr, td, i, txtValue, index;
		input = document.getElementById("filter_box");
		index = document.getElementById("searchselect").value
		filter = input.value.toUpperCase();
		table = document.getElementById("dataTable");
		tr = table.getElementsByTagName("tr");
		for (i = 0; i < tr.length; i++) {
			td = tr[i].getElementsByTagName("td")[index];
			if (td) {
				txtValue = td.textContent || td.innerText;
				if (txtValue.toUpperCase().indexOf(filter) > -1) {
					tr[i].style.display = "";
				} else {
					tr[i].style.display = "none";
				}
			}       
		}
	}

	function sortTable(n) {
		var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
		table = document.getElementById("dataTable");
		switching = true;
		//Set the sorting direction to ascending:
		dir = "asc"; 
		/*Make a loop that will continue until
		no switching has been done:*/
		while (switching) {
			//start by saying: no switching is done:
			switching = false;
			rows = table.rows;
			/*Loop through all table rows (except the
			first, which contains table headers):*/
			for (i = 1; i < (rows.length - 1); i++) {
				//start by saying there should be no switching:
				shouldSwitch = false;
				/*Get the two elements you want to compare,
				one from current row and one from the next:*/
				// let columns = rows[i].getElementsByTagName("TD");
				x = rows[i].getElementsByTagName("TD")[n];
				y = rows[i + 1].getElementsByTagName("TD")[n];
				/*check if the two rows should switch place,
				based on the direction, asc or desc:*/
				if (dir == "asc") {
				if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
					//if so, mark as a switch and break the loop:
					shouldSwitch= true;
					break;
				}
				} else if (dir == "desc") {
				if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
					//if so, mark as a switch and break the loop:
					shouldSwitch = true;
					break;
				}
				}
			}
			if (shouldSwitch) {
				/*If a switch has been marked, make the switch
				and mark that a switch has been done:*/
				rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
				switching = true;
				//Each time a switch is done, increase this count by 1:
				switchcount ++;      
			} else {
				/*If no switching has been done AND the direction is "asc",
				set the direction to "desc" and run the while loop again.*/
				if (switchcount == 0 && dir == "asc") {
				dir = "desc";
				switching = true;
				}
			}
		}
	}
	</script>
</body>
</html>